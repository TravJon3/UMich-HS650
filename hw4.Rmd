---
title: "Homework 4"
subtitle: "<h2><u>Data Science and Predictive Analytics (HS650), Fall 2021</u></h2>"
author: "<h3>Kevin Wu</h3>"
date: "`r format(Sys.time(), '%B %Y')`"
tags: [DSPA, SOCR, MIDAS, Big Data, Predictive Analytics] 
output:
  html_document:
    theme: spacelab
    highlight: tango
    toc: true
    number_sections: true
    toc_depth: 2
    toc_float:
      collapsed: false
      smooth_scroll: true
    code_folding: show
    self_contained: yes
---
**Homework_4_HS650_Fall_2021.Rmd**.

 * HW #4
 * Fall 2021, DSPA (HS650)
 * Name: Kevin Wu
 * SID: ####0012 (last 4 digits only)
 * UMich E-mail: kevinkwu@umich.edu
 * I certify that the following paper represents my own independent work and conforms with the guidelines of academic honesty described in the UMich student handbook.
 * Remember that students are allowed and encouraged to discuss, on a conceptual level, the problems with your class mates, however, this can not involve the exchange of actual code, printouts, solutions, e-mails or other explicit electronic or paper handouts.

```{r Libararies, warning=F, message=F}
library(rvest)
library(tm)
library(wordcloud)
library(plotly)
library(e1071)
library(gmodels)
library(C50)
library(caret)
library(rpart)
library(rpart.utils)
```

# HW Problem 4.1, Data Preparation, and Distributions
```{r 4.1, warning=F, message=F}
urlSOCR <- read_html("http://wiki.socr.umich.edu/index.php/SOCR_Data_2011_US_JobsRanking#2011_Ranking_of_the_200_most_common_Jobs_in_the_US")
socrDF <- html_table(html_nodes(urlSOCR, "table")[[1]])
jsdDF <- socrDF[-1]
jsdDF$Description <- gsub('_', ' ', jsdDF$Description)
#jsdDF$Job_Title <- gsub('_', ' ', jsdDF$Job_Title)

plot_ly(jsdDF, x = ~Stress_Category, y = ~Hiring_Potential, type="box") %>%
  layout(title = "Hiring Potential Given Stress Category", xaxis = list(title = "Stress Category"), yaxis = list(title = "Hiring Potential"))
plot_ly(jsdDF, x = ~Hiring_Potential, type="histogram") %>%
  layout(title = "Hiring Potential Distribution", xaxis = list(title = "Hiring Potential"), bargap=0.1)
plot_ly(jsdDF, x = ~Stress_Category, type="histogram") %>%
  layout(title = "Stress Category Distribution", xaxis = list(title = "Stress Category"), bargap=0.1)
plot_ly(jsdDF, x = ~Stress_Category, y = ~`Average_Income(USD)`, type="box") %>%
  layout(title = "Average Income (USD) Given Stress Category", xaxis = list(title = "Stress Category"), yaxis = list(title = "Average Income (USD)"))
plot_ly(jsdDF, x = ~Physical_Demand, y = ~`Average_Income(USD)`, type="scatter") %>%
#  add_lines(x = ~Physical_Demand, y= ~lm( Physical_Demand ~ `Average_Income(USD)`)) %>%
  layout(title = "Average Income (USD) Given Physical Demand", xaxis = list(title = "Physical Demand"), yaxis = list(title = "Average Income (USD)"))

corpusJSD <- Corpus(VectorSource(jsdDF$Description))
corpusJSD <- tm_map(corpusJSD, tolower)
corpusJSD <- tm_map(corpusJSD, removePunctuation)
corpusJSD <- tm_map(corpusJSD, stripWhitespace)
corpusJSD <- tm_map(corpusJSD, removeNumbers)
corpusJSD <- tm_map(corpusJSD, removeWords, stopwords('english'))
jsdDTM <- DocumentTermMatrix(corpusJSD)

set.seed(12345)
subsetInterval <- sample(nrow(jsdDF), floor(nrow(jsdDF) * 0.9))  # 90% training + 10% testing
jsdDFTrain <- jsdDF[subsetInterval, ]
jsdDFTest <- jsdDF[-subsetInterval, ]
jsdDTMTrain <- jsdDTM[subsetInterval, ] 
jsdCorpusTrain <- corpusJSD[subsetInterval]
jsdCorpusTest <- corpusJSD[-subsetInterval]

#See Distribution of Stress Categories between Training vs Testing datasets
prop.table(table(jsdDFTrain$Stress_Category))
prop.table(table(jsdDFTest$Stress_Category))

#Binari"ize" Stress label for training and testing datasets
jsdDFTrain$Stress_High <- jsdDFTrain$Stress_Category %in% c(3:5)
jsdDFTrain$Stress_High <- factor(jsdDFTrain$Stress_High, levels = c(F, T), labels = c("Low_Stress", "High_Stress"))
jsdDFTest$Stress_High <- jsdDFTest$Stress_Category %in% c(3:5)
jsdDFTest$Stress_High <- factor(jsdDFTest$Stress_High, levels = c(F, T), labels = c("Low_Stress", "High_Stress"))

prop.table(table(jsdDFTrain$Stress_High))
prop.table(table(jsdDFTest$Stress_High))
```

## Word Cloud and Graphics Between Low and High Stress Categories
```{r Low and High Stress Categories, warning=F, message=F}
# separate out low vs high stress from training data for graphics
jsdDFTrainLow <- subset(jsdDFTrain, Stress_High=="Low_Stress")
jsdDFTrainHigh <- subset(jsdDFTrain, Stress_High=="High_Stress")
jsdCorpusTrainLow <- Corpus(VectorSource(jsdDFTrainLow$Description))
jsdCorpusTrainLow <- tm_map(jsdCorpusTrainLow, tolower)
jsdCorpusTrainLow <- tm_map(jsdCorpusTrainLow, removePunctuation)
jsdCorpusTrainLow <- tm_map(jsdCorpusTrainLow, removeNumbers)
jsdCorpusTrainLow <- tm_map(jsdCorpusTrainLow, stripWhitespace)
jsdCorpusTrainLow <- tm_map(jsdCorpusTrainLow, removeWords, stopwords('english'))
jsdCorpusTrainHigh <- Corpus(VectorSource(jsdDFTrainHigh$Description))
jsdCorpusTrainHigh <- tm_map(jsdCorpusTrainHigh, tolower)
jsdCorpusTrainHigh <- tm_map(jsdCorpusTrainHigh, removeNumbers)
jsdCorpusTrainHigh <- tm_map(jsdCorpusTrainHigh, removePunctuation)
jsdCorpusTrainHigh <- tm_map(jsdCorpusTrainHigh, stripWhitespace)
jsdCorpusTrainHigh <- tm_map(jsdCorpusTrainHigh, removeWords, stopwords('english'))
jsdDTMTrainLow <- DocumentTermMatrix(jsdCorpusTrainLow)
jsdDTMTrainLow <- removeSparseTerms(jsdDTMTrainLow, 0.98)
jsdDTMTrainHigh <- DocumentTermMatrix(jsdCorpusTrainHigh)
jsdDTMTrainHigh <- removeSparseTerms(jsdDTMTrainHigh, 0.98)
# Low Stress Jobs
wordcloud(jsdCorpusTrainLow, min.freq = 7, random.order = FALSE, colors = brewer.pal(4, "Dark2"))
wordSumLow <- colSums(as.matrix(jsdDTMTrainLow))
plot_ly(x = ~unname(wordSumLow), y = ~names(wordSumLow), type="bar", orientation="h") %>%
  layout(title="Common Word Descriptions Low Stress Jobs", xaxis = list(title = "Words"), yaxis = list(title = "Counts"), bargap="0.1")
# High Stress Jobs
wordcloud(jsdCorpusTrainHigh, min.freq = 3, random.order = FALSE, colors = brewer.pal(4, "Dark2"))
wordSumHigh <- colSums(as.matrix(jsdDTMTrainHigh))
plot_ly(x = ~unname(wordSumHigh), y = ~names(wordSumHigh), type="bar", orientation="h") %>%
  layout(title="Common Word Descriptions High Stress Jobs", xaxis = list(title = "Words"), yaxis = list(title = "Counts"), bargap="0.1")
```

## Naive Bayes
```{r Naive Bayes, warning=F, message=F}
# Create Function to binary"ize" Yes/No whether word appears > 5 times in the DTM and Apply
convertToCounts <- function(wordFrequency) {
  wordFrequency <- ifelse(wordFrequency > 0, 1, 0)
  wordFrequency < factor(wordFrequency, levels = c(0, 1), labels = c("No", "Yes"))
  return(wordFrequency)
}

#create training dictionary object & respective DTMs
jsdDict <- as.character(findFreqTerms(jsdDTMTrain, 5))
jsdDTMTrain <- DocumentTermMatrix(jsdCorpusTrain, list(dictionary = jsdDict))
jsdDTMTest <- DocumentTermMatrix(jsdCorpusTest, list(dictionary = jsdDict))

jsdTrain <- apply(jsdDTMTrain, MARGIN = 2, convertToCounts)
jsdTest <- apply(jsdDTMTest, MARGIN = 2, convertToCounts)


jsdBayesClassifier <- naiveBayes(jsdTrain, jsdDFTrain$Stress_High, laplace = 0)
jsdBayesPredict <- predict(jsdBayesClassifier, jsdTest, type="raw")
head(jsdBayesPredict)
# crossTable <- CrossTable(jsdBayesPredict, jsdDFTest$Stress_High)
# crossTable
```

## LDA
```{r LDA, warning=F, message=F}


```

## C5.0
```{r C5.0, warning=F, message=F}
jsdTree50 <- C5.0(jsdTrain, jsdDFTrain$Stress_High)
jsdTree50
summary(jsdTree50)

jsdTree50Predict <- predict(jsdTree50, jsdTest)
confusionMatrix(table(jsdTree50Predict, jsdDFTest$Stress_High))

plot(jsdTree50, subtree = 1)

```

## Multiple Linear Regression
```{r Multiple Linear Regression, warning=F, message=F}

fit <- lm(formula = Overall_Score ~ `Average_Income(USD)` + Work_Environment + Stress_Level + Stress_Category + Physical_Demand + Hiring_Potential, jsdDF)
summary(fit)

plot_ly(x=fit$fitted.values, y=fit$residuals, type="scatter", mode="markers") %>%
  layout(title="LM: Fitted-values vs. Model-Residuals",
         xaxis=list(title="Fitted"), 
         yaxis = list(title="Residuals"))
step(fit,direction = "backward")
