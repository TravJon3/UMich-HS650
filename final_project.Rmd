---
title: "Final Project"
subtitle: "<h2><u>Data Science and Predictive Analytics (HS650), Fall 2021</u></h2>"
author: "<h3>Kevin Wu</h3>"
date: "`r format(Sys.time(), '%B %Y')`"
tags: [DSPA, SOCR, MIDAS, Big Data, Predictive Analytics] 
output:
  html_document:
    theme: spacelab
    highlight: tango
    toc: true
    number_sections: true
    toc_depth: 2
    toc_float:
      collapsed: false
      smooth_scroll: true
    code_folding: show
    self_contained: yes
---
**Final Project.Rmd**.

 * Final Project
 * Fall 2021, DSPA (HS650)
 * Name: Kevin Wu
 * SID: ####0012 (last 4 digits only)
 * UMich E-mail: kevinkwu@umich.edu
 * I certify that the following paper represents my own independent work and conforms with the guidelines of academic honesty described in the UMich student handbook.
 * Remember that students are allowed and encouraged to discuss, on a conceptual level, the problems with your class mates, however, this can not involve the exchange of actual code, printouts, solutions, e-mails or other explicit electronic or paper handouts.


# Final Project Introduction


```{r Introduction, warning=F, message=F}

library(haven)
library(stringr)
library(DT)
library(plotly)
```

# Data Preparation
```{r Data Preparation, warning=F, message=F}
#load and convert Stata data into R dataframe frames into environment
df <- read_dta("http://kevinwurn.github.io/UMich-HS650/final_project_files/masterfile.dta", encoding = "latin1")
ncol(df)
nrow(df)
print(paste0("1: ", names(attributes(df[[4]])$labels[1]), "2: ", names(attributes(df[[4]])$labels[2])))


convertDataframe = function(strType) {
  mapping <- c("%8.0g"="byte", "%8.0g"="int", "%12.0g"="long", "%9.0g"="float", "%10.0g"="double", "%#s"="str#", "%9s"="strL")
  mapping[strType]
}
```

# Data Summary
```{r Data Summary, warning=F, message=F}
dfDisplay <- data.frame(matrix(ncol = 0, nrow = ncol(df)))
vectName <- vector(length = ncol(df))
vectLabel <- vector(length = ncol(df))
vectFormat <- vector(length = ncol(df))
vectDescriptions <- vector(length = ncol(df))

for(i in 1:ncol(df)) {
  vectName[i] <- names(df[, i])
  if(is.null(attributes(df[[i]])$label) == F)
    vectLabel[i] <- attributes(df[[i]])$label
  if(is.null(attributes(df[[i]])$format.stata) == F)
    vectFormat[i] <- lapply(attributes(df[[i]])$format.stata, convertDataframe)
  if(is.null(attributes(df[[i]])$class) == F && attributes(df[[i]])$class[3] == "double")
    vectFormat[i] <- "double"
  if(is.null(attributes(df[[i]])$labels) == F && length(attributes(df[[i]])$labels) > 0) {
    vectLabels <- list(length(attributes(df[[i]])$labels))
    for(j in 1:length(attributes(df[[i]])$labels)) {
      vectLabels[j] <- as.character(attributes(df[[i]])$labels[j])
      if(is.null(names(attributes(df[[i]])$labels[j])) == F && as.character(names(attributes(df[[i]])$labels[j])) != "Actual number")
        vectLabels[j] <- paste(c(vectLabels[j], ":", as.character(names(attributes(df[[i]])$labels[j]))), collapse = " ")
      else if(as.character(names(attributes(df[[i]])$labels[j])) == "Actual number")
        vectLabels[j] <- paste0(vectLabels[j], ":::")
    }
    vectDescriptions[i] <- str_flatten(vectLabels, "<br />")
    vectDescriptions[i] <- str_replace_all(vectDescriptions[i], ":::<br />", ", ")
  }
}
dfDisplay$ColumnName <- vectName
dfDisplay$Label <- vectLabel
dfDisplay$Format<- vectFormat
dfDisplay$Labels <- vectDescriptions

datatable(dfDisplay, options = list(
  pageLength=100,
  lengthMenu=c(20,50,100,150,250,582)
  ), 
  escape=F
)
```